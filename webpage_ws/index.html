<!DOCTYPE html>
<html>

<head>
    <title>Piper TicTacToe</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://s3.eu-west-1.amazonaws.com/rosject.io/js/roslib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eventemitter2@5.0.1/lib/eventemitter2.min.js"></script>
    <script type="text/javascript" src="./libs/mjpegcanvas.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="main-header">
        <h1>TicTacToBot</h1>
        <p>Will you beat it ?</p>
    </header>

    <main id="vueApp">
        <div class="game-container">
            <div class="left-section">
                <div class="top-row">
                    <!-- Piper Controls -->
                    <div class="left-panel">
                        <div class="panel-card">
                            <h3>Robot Positions</h3>
                            <div class="position-grid">
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(6)">6</button>
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(7)">7</button>
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(8)">8</button>
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(3)">3</button>
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(4)">4</button>
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(5)">5</button>
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(0)">0</button>
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(1)">1</button>
                                <button class="pos-btn" :disabled="!connected" @click="goToPos(2)">2</button>
                            </div>
                            <div class="action-buttons">
                                <button class="action-btn" :disabled="!connected" @click="goToPos(10)">Stand-by</button>
                                <button class="action-btn" :disabled="!connected" @click="goToPos(12)">Home</button>
                            </div>
                        </div>

                        <div class="panel-card">
                            <h3>Robot Actions</h3>
                            <div class="action-buttons">
                                <button class="action-btn" :disabled="!connected" @click="drawShape(2)">Draw
                                    Grid</button>
                                <button class="action-btn draw-circle" :disabled="!connected" @click="drawShape(0)">Draw
                                    Circle</button>
                                <button class="action-btn draw-cross" :disabled="!connected" @click="drawShape(1)">Draw
                                    Cross</button>
                                <button class="action-btn" :disabled="!connected" @click="goToPos(11)">Clear
                                    Board</button>
                            </div>
                        </div>
                    </div>

                    <!-- Board + game setup ! -->
                    <div class="center-panel">
                        <div class="panel-card">
                            <h3>Game Board</h3>
                            <div class="tictactoe-grid">
                                <div v-for="index in [6,7,8,3,4,5,0,1,2]" :key="index" class="grid-cell">
                                    <div v-if="game_board_state[index] === 0" class="empty-cell"></div>
                                    <img v-else-if="game_board_state[index] === 1" src="./images/cross.png"
                                        class="shape-img" alt="X" width="50" />
                                    <img v-else-if="game_board_state[index] === 2" src="./images/circle.png"
                                        class="shape-img" alt="O" width="50" />
                                    <div v-else class="undefined-cell">?</div>
                                </div>
                            </div>
                            <div class="board-status">
                                <p>Board State: {{ game_board_state }}</p>
                            </div>
                            <div v-if="winner === 1" class="winner-display">
                                <img src="./images/cross.png" class="shape-img" alt="X"
                                    style="width:50px;height:50px;max-width:50px;max-height:50px;" />
                                Cross WINS!

                            </div>
                            <div v-else-if="winner === 2" class="winner-display">
                                <img src="./images/circle.png" class="shape-img" alt="X"
                                    style="width:50px;height:50px;max-width:50px;max-height:50px;" />
                                Circle WINS!
                            </div>
                            <div v-else-if="winner === 3" class="winner-display">
                                Its a DRAW
                            </div>
                        </div>

                        <div class="panel-card">
                            <h3>Game Control</h3>
                            <div class="game-control-center">
                                <button class="action-btn" :disabled="!connected" @click="startGame()">Start
                                    Game</button>
                            </div>
                            <div class="swap-section">
                                <button class="action-btn" :disabled="!connected" @click="swapShapes">Swap
                                    Shapes</button>
                            </div>

                            <div class="players">
                                <div class="player">
                                    <span>Human</span>
                                    <img :src="human_shape === 1 ? './images/cross.png' : './images/circle.png'"
                                        width="50" />
                                </div>
                                <div class="player">
                                    <span>Robot</span>
                                    <img :src="robot_shape === 1 ? './images/cross.png' : './images/circle.png'"
                                        width="50" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Camera Feed -->
                <div class="panel-card camera-panel">
                    <h3>Raw Camera</h3>
                    <div id="divCamera2" class="camera-container"></div>
                </div>
            </div>

            <!-- Camera processsss -->
            <div class="right-panel">
                <!--
                <div class="panel-card slider panel">
                    <h3>Perception params</h3>
                    <input type="range" min="1" max="8" v-model.number="slider_val" />
                    <span>{{ slider_val }}</span>
                    <input type="range" min="2" max="20" v-model.number="slider2_val" />
                    <span>{{ slider2_val }}</span>
                    <input type="range" min="0" max="200" v-model.number="slider3_val" />
                    <span>{{ slider3_val }}</span>
                </div>
                -->
                <div class="panel-card camera-panel">
                    <h3>Camera Feed</h3>
                    <select v-model="video_server" class="video-select">
                        <option value="/camera/D435/color/image_raw">Raw Image</option>
                        <option value="/grid_lines_perception_server">grid-lines</option>
                        <option value="/vertical_filter_perception_server">vertically-filtered</option>
                        <option value="/horizontal_filter_perception_server">horizontally-filtered</option>
                        <option value="/detected_grid_perception_server">detected-grid</option>
                        <option value="/perception_server">final-perception</option>
                    </select>
                    <div id="divCamera" class="camera-container"></div>
                </div>
            </div>
        </div>
    </main>

    <script type="text/javascript">
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = 'main.js?v=2.' + Date.now();
        document.head.appendChild(script);
    </script>
</body>

</html>